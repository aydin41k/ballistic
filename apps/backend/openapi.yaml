openapi: 3.0.3
info:
  title: Ballistic Backend API
  description: |
    API documentation for the Ballistic Backend application.
    
    This application provides item and project management with authentication features.
    
    ## Authentication
    The API uses both session-based authentication and token-based authentication via Laravel Sanctum.
    
    ### Session Authentication
    Web routes use session-based authentication with CSRF protection.
    
    ### Token Authentication
    API endpoints can use Bearer token authentication. To obtain a token:
    1. Register a new account via `POST /api/register` or
    2. Login with existing credentials via `POST /api/login`
    
    Include the token in subsequent requests using the `Authorization` header:
    ```
    Authorization: Bearer {your-token}
    ```
    
  version: 0.1.0
  contact:
    name: Ballistic Backend
  license:
    name: Proprietary

servers:
  - url: http://localhost
    description: Local development server
  - url: https://api.ballistic.app
    description: Production server

tags:
  - name: Authentication
    description: User authentication and registration endpoints (Session-based)
  - name: API Authentication
    description: API token-based authentication endpoints
  - name: Items
    description: Item management endpoints (API)
  - name: Profile
    description: User profile and settings management
  - name: Password
    description: Password management and reset
  - name: Email Verification
    description: Email verification endpoints

paths:
  # API Authentication Routes
  /api/register:
    post:
      tags:
        - API Authentication
      summary: Register a new user (API)
      description: Create a new user account and receive an API token
      operationId: apiRegister
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
                - password_confirmation
              properties:
                name:
                  type: string
                  example: John Doe
                email:
                  type: string
                  format: email
                  example: john@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: SecurePassword123
                password_confirmation:
                  type: string
                  format: password
                  minLength: 8
                  example: SecurePassword123
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User registered successfully
                  user:
                    $ref: '#/components/schemas/User'
                  token:
                    type: string
                    example: 1|abcdef1234567890abcdef1234567890
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /api/login:
    post:
      tags:
        - API Authentication
      summary: Login with API credentials
      description: Authenticate a user and receive an API token
      operationId: apiLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: john@example.com
                password:
                  type: string
                  format: password
                  example: SecurePassword123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Login successful
                  user:
                    $ref: '#/components/schemas/User'
                  token:
                    type: string
                    example: 2|abcdef1234567890abcdef1234567890
        '422':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequests'

  /api/logout:
    post:
      tags:
        - API Authentication
      summary: Logout and revoke API token
      description: Revoke the user's current API token
      operationId: apiLogout
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logged out successfully
        '401':
          $ref: '#/components/responses/Unauthorised'

  # Authentication Routes
  /register:
    get:
      tags:
        - Authentication
      summary: Show registration form
      description: Display the registration page
      operationId: showRegister
      responses:
        '200':
          description: Registration form displayed
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Create a new user account
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
                - password_confirmation
              properties:
                name:
                  type: string
                  example: John Doe
                email:
                  type: string
                  format: email
                  example: john@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: SecurePassword123
                password_confirmation:
                  type: string
                  format: password
                  minLength: 8
                  example: SecurePassword123
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /login:
    get:
      tags:
        - Authentication
      summary: Show login form
      description: Display the login page
      operationId: showLogin
      responses:
        '200':
          description: Login form displayed
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Authentication
      summary: Authenticate user
      description: Log in an existing user
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: john@example.com
                password:
                  type: string
                  format: password
                  example: SecurePassword123
                remember:
                  type: boolean
                  example: true
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Login successful
        '422':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /logout:
    post:
      tags:
        - Authentication
      summary: Log out user
      description: End the authenticated user's session
      operationId: logout
      security:
        - sessionAuth: []
      responses:
        '204':
          description: Logout successful
        '401':
          $ref: '#/components/responses/Unauthorised'

  /forgot-password:
    get:
      tags:
        - Password
      summary: Show forgot password form
      description: Display the password reset request form
      operationId: showForgotPassword
      responses:
        '200':
          description: Forgot password form displayed
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Password
      summary: Send password reset link
      description: Send a password reset link to the user's email
      operationId: sendPasswordResetLink
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: john@example.com
      responses:
        '200':
          description: Password reset link sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password reset link sent to your email
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /reset-password/{token}:
    get:
      tags:
        - Password
      summary: Show password reset form
      description: Display the password reset form with token
      operationId: showResetPassword
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
          description: Password reset token
      responses:
        '200':
          description: Password reset form displayed
          content:
            text/html:
              schema:
                type: string

  /reset-password:
    post:
      tags:
        - Password
      summary: Reset password
      description: Reset the user's password using the reset token
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - email
                - password
                - password_confirmation
              properties:
                token:
                  type: string
                  example: abc123token
                email:
                  type: string
                  format: email
                  example: john@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: NewSecurePassword123
                password_confirmation:
                  type: string
                  format: password
                  minLength: 8
                  example: NewSecurePassword123
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password reset successfully
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /verify-email:
    get:
      tags:
        - Email Verification
      summary: Show email verification prompt
      description: Display the email verification notice
      operationId: showVerifyEmail
      security:
        - sessionAuth: []
      responses:
        '200':
          description: Email verification prompt displayed
          content:
            text/html:
              schema:
                type: string
        '401':
          $ref: '#/components/responses/Unauthorised'

  /verify-email/{id}/{hash}:
    get:
      tags:
        - Email Verification
      summary: Verify email address
      description: Verify the user's email address using verification link
      operationId: verifyEmail
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
        - name: hash
          in: path
          required: true
          schema:
            type: string
          description: Verification hash
      responses:
        '302':
          description: Email verified, redirected
        '401':
          $ref: '#/components/responses/Unauthorised'
        '403':
          description: Invalid verification link

  /email/verification-notification:
    post:
      tags:
        - Email Verification
      summary: Resend verification email
      description: Resend the email verification notification
      operationId: resendVerificationEmail
      security:
        - sessionAuth: []
      responses:
        '200':
          description: Verification email sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Verification email sent
        '401':
          $ref: '#/components/responses/Unauthorised'
        '429':
          $ref: '#/components/responses/TooManyRequests'

  /confirm-password:
    get:
      tags:
        - Password
      summary: Show password confirmation form
      description: Display the password confirmation form
      operationId: showConfirmPassword
      security:
        - sessionAuth: []
      responses:
        '200':
          description: Password confirmation form displayed
          content:
            text/html:
              schema:
                type: string
        '401':
          $ref: '#/components/responses/Unauthorised'
    post:
      tags:
        - Password
      summary: Confirm password
      description: Confirm the user's password for sensitive operations
      operationId: confirmPassword
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  format: password
                  example: SecurePassword123
      responses:
        '200':
          description: Password confirmed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password confirmed
        '401':
          $ref: '#/components/responses/Unauthorised'
        '422':
          description: Invalid password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequests'

  # Settings/Profile Routes
  /settings/profile:
    get:
      tags:
        - Profile
      summary: Show profile edit form
      description: Display the profile edit page
      operationId: showEditProfile
      security:
        - sessionAuth: []
      responses:
        '200':
          description: Profile edit form displayed
          content:
            text/html:
              schema:
                type: string
        '401':
          $ref: '#/components/responses/Unauthorised'
    patch:
      tags:
        - Profile
      summary: Update profile
      description: Update the authenticated user's profile information
      operationId: updateProfile
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: John Doe
                email:
                  type: string
                  format: email
                  example: john@example.com
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorised'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
    delete:
      tags:
        - Profile
      summary: Delete account
      description: Delete the authenticated user's account
      operationId: deleteAccount
      security:
        - sessionAuth: []
      responses:
        '204':
          description: Account deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorised'

  /settings/password:
    get:
      tags:
        - Password
      summary: Show password edit form
      description: Display the password change form
      operationId: showEditPassword
      security:
        - sessionAuth: []
      responses:
        '200':
          description: Password edit form displayed
          content:
            text/html:
              schema:
                type: string
        '401':
          $ref: '#/components/responses/Unauthorised'
    put:
      tags:
        - Password
      summary: Update password
      description: Update the authenticated user's password
      operationId: updatePassword
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - current_password
                - password
                - password_confirmation
              properties:
                current_password:
                  type: string
                  format: password
                  example: CurrentPassword123
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: NewPassword123
                password_confirmation:
                  type: string
                  format: password
                  minLength: 8
                  example: NewPassword123
      responses:
        '200':
          description: Password updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password updated successfully
        '401':
          $ref: '#/components/responses/Unauthorised'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequests'

  /settings/appearance:
    get:
      tags:
        - Profile
      summary: Show appearance settings
      description: Display the appearance settings page
      operationId: showAppearance
      security:
        - sessionAuth: []
      responses:
        '200':
          description: Appearance settings displayed
          content:
            text/html:
              schema:
                type: string
        '401':
          $ref: '#/components/responses/Unauthorised'

  # API Routes - Items
  /api/items:
    get:
      tags:
        - Items
      summary: List all items
      description: |
        Retrieve a list of items belonging to the authenticated user.
        Can be filtered by project_id and status.
      operationId: getItems
      security:
        - bearerAuth: []
        - sessionAuth: []
      parameters:
        - name: project_id
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: Filter items by project ID
        - name: status
          in: query
          required: false
          schema:
            type: string
            enum: [todo, doing, done, wontdo]
          description: Filter items by status
      responses:
        '200':
          description: List of items retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Item'
        '401':
          $ref: '#/components/responses/Unauthorised'

    post:
      tags:
        - Items
      summary: Create a new item
      description: Create a new item for the authenticated user
      operationId: createItem
      security:
        - bearerAuth: []
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - status
              properties:
                title:
                  type: string
                  maxLength: 65535
                  example: Complete project documentation
                description:
                  type: string
                  nullable: true
                  maxLength: 65535
                  example: Write comprehensive API documentation
                status:
                  type: string
                  enum: [todo, doing, done, wontdo]
                  example: todo
                project_id:
                  type: string
                  format: uuid
                  nullable: true
                  example: 123e4567-e89b-12d3-a456-426614174000
                position:
                  type: integer
                  minimum: 0
                  example: 0
      responses:
        '201':
          description: Item created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '401':
          $ref: '#/components/responses/Unauthorised'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /api/items/{id}:
    get:
      tags:
        - Items
      summary: Get a specific item
      description: Retrieve details of a specific item
      operationId: getItem
      security:
        - bearerAuth: []
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Item ID
      responses:
        '200':
          description: Item details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '401':
          $ref: '#/components/responses/Unauthorised'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags:
        - Items
      summary: Update an item (full update)
      description: Update all fields of an existing item
      operationId: updateItemPut
      security:
        - bearerAuth: []
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Item ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  maxLength: 65535
                  example: Complete project documentation
                description:
                  type: string
                  nullable: true
                  maxLength: 65535
                  example: Write comprehensive API documentation
                status:
                  type: string
                  enum: [todo, doing, done, wontdo]
                  example: doing
                project_id:
                  type: string
                  format: uuid
                  nullable: true
                  example: 123e4567-e89b-12d3-a456-426614174000
                position:
                  type: integer
                  minimum: 0
                  example: 1
      responses:
        '200':
          description: Item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '401':
          $ref: '#/components/responses/Unauthorised'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

    patch:
      tags:
        - Items
      summary: Update an item (partial update)
      description: Update specific fields of an existing item
      operationId: updateItemPatch
      security:
        - bearerAuth: []
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Item ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  maxLength: 65535
                  example: Complete project documentation
                description:
                  type: string
                  nullable: true
                  maxLength: 65535
                  example: Write comprehensive API documentation
                status:
                  type: string
                  enum: [todo, doing, done, wontdo]
                  example: doing
                project_id:
                  type: string
                  format: uuid
                  nullable: true
                  example: 123e4567-e89b-12d3-a456-426614174000
                position:
                  type: integer
                  minimum: 0
                  example: 1
      responses:
        '200':
          description: Item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '401':
          $ref: '#/components/responses/Unauthorised'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

    delete:
      tags:
        - Items
      summary: Delete an item
      description: Soft delete an item (moves to trash)
      operationId: deleteItem
      security:
        - bearerAuth: []
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Item ID
      responses:
        '204':
          description: Item deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorised'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: Token
      description: Laravel Sanctum API token authentication
    sessionAuth:
      type: apiKey
      in: cookie
      name: laravel_session
      description: Laravel session-based authentication

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
        name:
          type: string
          example: John Doe
        email:
          type: string
          format: email
          example: john@example.com
        email_verified_at:
          type: string
          format: date-time
          nullable: true
          example: 2025-10-08T12:00:00.000000Z
        created_at:
          type: string
          format: date-time
          example: 2025-10-08T10:00:00.000000Z
        updated_at:
          type: string
          format: date-time
          example: 2025-10-08T10:00:00.000000Z
      required:
        - id
        - name
        - email

    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
        user_id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174001
        name:
          type: string
          example: Personal Tasks
        color:
          type: string
          nullable: true
          example: "#3B82F6"
        archived_at:
          type: string
          format: date-time
          nullable: true
          example: null
        created_at:
          type: string
          format: date-time
          example: 2025-10-08T10:00:00.000000Z
        updated_at:
          type: string
          format: date-time
          example: 2025-10-08T10:00:00.000000Z
        deleted_at:
          type: string
          format: date-time
          nullable: true
          example: null
      required:
        - id
        - user_id
        - name

    Item:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
        user_id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174001
        project_id:
          type: string
          format: uuid
          nullable: true
          example: 123e4567-e89b-12d3-a456-426614174002
        title:
          type: string
          example: Complete project documentation
        description:
          type: string
          nullable: true
          example: Write comprehensive API documentation
        status:
          type: string
          enum: [todo, doing, done, wontdo]
          example: todo
        position:
          type: integer
          example: 0
        created_at:
          type: string
          format: date-time
          example: 2025-10-08T10:00:00.000000Z
        updated_at:
          type: string
          format: date-time
          example: 2025-10-08T10:00:00.000000Z
        deleted_at:
          type: string
          format: date-time
          nullable: true
          example: null
        project:
          nullable: true
          allOf:
            - $ref: '#/components/schemas/Project'
      required:
        - id
        - user_id
        - title
        - status
        - position

    ValidationError:
      type: object
      properties:
        message:
          type: string
          example: The given data was invalid.
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
          example:
            email:
              - The email field is required.
            password:
              - The password must be at least 8 characters.

    Error:
      type: object
      properties:
        message:
          type: string
          example: An error occurred

  responses:
    Unauthorised:
      description: Unauthorised - Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Unauthenticated.

    Forbidden:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: This action is unauthorised.

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Resource not found.

    TooManyRequests:
      description: Too many requests - Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Too many requests. Please try again later.

